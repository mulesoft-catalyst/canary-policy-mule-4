id: canary-release-mule4
name: Canary Release (Mule 4)
description: A custom policy to support canary releases
category: Custom
type: custom
resourceLevelSupported: true
encryptionSupported: false
standalone: true
requiredCharacteristics: []
providedCharacteristics: []
configuration:
  - propertyName: weights
    name: Endpoints
    description: Accepts a DW expression array of endpoints defined as objects, where url identifies the destination urls and weight assign a percentage weight to each destination. Requires to set the original non-canary version at least. Non limited entries are accepted as long sum of weights do not exceed 100 (100%)
    defaultValue: '#[{"url": "domain.com/api-name/v1/", "weight": 100}]'
    type: expression
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: host
    name: Host
    description: Host for endpoints
    defaultValue: 'localhost'
    type: string
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: port
    name: Port
    description: Port
    defaultValue: 8081
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    minimumValue: 0
    maximumValue: 65535
  - propertyName: protocol
    name: Protocol
    description: Protocol
    defaultValue: 'HTTPS'
    options:
    - name: HTTP
      value: "HTTP"
    - name: HTTPS
      value: "HTTPS"
    type: radio
    defaultValue: HTTP
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: sessionStickinessSupport
    name: Support Session Stickness?
    description: Select this option to support session stickiness using an HTTP header
    type: boolean
    optional: true
    defaultValue: false
  - propertyName: sessionHeader
    name: Session Stickiness Header Expression
    description: Expresson used to parse the session header
    type: expression
    optional: true
    sensitive: false
    allowMultiple: false
    defaultValue: "#[attributes.headers.'X-session-id']"
    dependsOnKey: sessionStickinessSupport
    dependsOnValue: true
  - propertyName: osPersistent
    name: Is the Object Store persistent?
    description: Select this option to enable a persistent Object Store. The default is false.
    type: boolean
    optional: true
    defaultValue: false
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
  - propertyName: osTtl
    name: Object Store's entry TTL
    description: The entry timeout. Default value is 1 (hour).
    type: int
    optional: true
    sensitive: false
    allowMultiple: false
    defaultValue: "1"
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
  - propertyName: osTtlUnit
    name: Object Store's entry TTL unit
    description: The time unit. Default value is "HOURS".
    options:
    - name: DAYS
      value: "DAYS"
    - name: HOURS
      value: "HOURS"
    - name: MICROSECONDS
      value: "MICROSECONDS"
    - name: MILISECONDS
      value: "MILISECONDS"
    - name: MINUTES
      value: "MINUTES"
    - name: NANOSECONDS
      value: "NANOSECONDS"
    - name: SECONDS
      value: "SECONDS"
    type: radio
    defaultValue: HOURS
    optional: true
    sensitive: false
    allowMultiple: false
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
