id: canary-release-mule4
name: Canary Release (Mule 4)
description: A custom policy to support canary releases
category: Custom
type: custom
resourceLevelSupported: true
encryptionSupported: false
standalone: true
requiredCharacteristics: []
providedCharacteristics: []
configuration:
  - propertyName: host
    name: Host (Original)
    description: Host for original version
    defaultValue: 'localhost'
    type: string
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: port
    name: Port (Original)
    description: Port
    defaultValue: 8081
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    minimumValue: 0
    maximumValue: 65535
  - propertyName: protocol
    name: Protocol (Original)
    description: Protocol
    defaultValue: 'HTTPS'
    options:
    - name: HTTP
      value: "HTTP"
    - name: HTTPS
      value: "HTTPS"
    type: radio
    defaultValue: HTTP
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: path
    name: Path (Original)
    description: Path for original version
    defaultValue: '/api/v1/'
    type: string
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: weight
    name: Weight (Original)
    description: Weight
    defaultValue: 50
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    minimumValue: 5
    maximumValue: 100
  - propertyName: hostCanary
    name: Host (Canary)
    description: Host for original version
    defaultValue: 'localhost'
    type: string
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: portCanary
    name: Port (Canary)
    description: Port
    defaultValue: 8081
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    minimumValue: 0
    maximumValue: 65535
  - propertyName: protocolCanary
    name: Protocol (Canary)
    description: Protocol
    defaultValue: 'HTTPS'
    options:
    - name: HTTP
      value: "HTTP"
    - name: HTTPS
      value: "HTTPS"
    type: radio
    defaultValue: HTTP
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: pathCanary
    name: Path (Canary)
    description: Path for Canary version
    defaultValue: '/api/v2/'
    type: string
    optional: false
    sensitive: false
    allowMultiple: false
  - propertyName: weightCanary
    name: Weight (Canary)
    description: Weight
    defaultValue: 50
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    minimumValue: 5
    maximumValue: 100
  - propertyName: sessionStickinessSupport
    name: Support Session Stickness?
    description: Select this option to support session stickiness using an HTTP header
    type: boolean
    optional: true
    defaultValue: false
  - propertyName: sessionHeader
    name: Session Stickiness Header Expression
    description: Expresson used to parse the session header
    type: expression
    optional: true
    sensitive: false
    allowMultiple: false
    defaultValue: "#[attributes.headers.'X-session-id']"
    dependsOnKey: sessionStickinessSupport
    dependsOnValue: true
  - propertyName: overrideOsSettings
    name: Override Object Store Settings?
    description: Select this option to override the default Object Store. The default is false.
    type: boolean
    optional: true
    defaultValue: false
  - propertyName: osPersistent
    name: Is the Object Store persistent?
    description: Select this option to enable a persistent Object Store. The default is true.
    type: boolean
    optional: true
    defaultValue: true
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
  - propertyName: osTtl
    name: Object Store's entry TTL
    description: The entry timeout. Default value is 1 (hour).
    type: int
    optional: true
    sensitive: false
    allowMultiple: false
    defaultValue: "1"
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
  - propertyName: osTtlUnit
    name: Object Store's entry TTL unit
    description: The time unit. Default value is "HOURS".
    options:
    - name: DAYS
      value: "DAYS"
    - name: HOURS
      value: "HOURS"
    - name: MICROSECONDS
      value: "MICROSECONDS"
    - name: MILISECONDS
      value: "MILISECONDS"
    - name: MINUTES
      value: "MINUTES"
    - name: NANOSECONDS
      value: "NANOSECONDS"
    - name: SECONDS
      value: "SECONDS"
    type: radio
    defaultValue: HOURS
    optional: true
    sensitive: false
    allowMultiple: false
    dependsOnKey: overrideOsSettings
    dependsOnValue: true
  - propertyName: captureUsageMetrics
    name: Capture raw usage metrics?
    description: Select this option to capture raw metrics around endpoints usage
    type: boolean
    optional: true
    defaultValue: false
  - propertyName: metricsOsIndex
    name: Index used to store the metrics
    description: Expression used as index to store the metrics
    type: expression
    optional: true
    sensitive: false
    allowMultiple: false
    defaultValue: "#['metrics']"
    dependsOnKey: captureUsageMetrics
    dependsOnValue: true
  - propertyName: metricsOsPersistent
    name: Is the Metrics Object Store persistent?
    description: Select this option to enable a persistent Object Store for metrics. The default is false.
    type: boolean
    optional: false
    defaultValue: false
    dependsOnKey: captureUsageMetrics
    dependsOnValue: true
  - propertyName: metricsOsTtl
    name: Object Store's entry TTL
    description: The entry timeout. Default value is 1 (hour).
    type: int
    optional: false
    sensitive: false
    allowMultiple: false
    defaultValue: "1"
    dependsOnKey: captureUsageMetrics
    dependsOnValue: true
  - propertyName: metricsOsTtlUnit
    name: Object Store's entry TTL unit
    description: The time unit. Default value is "HOURS".
    options:
    - name: DAYS
      value: "DAYS"
    - name: HOURS
      value: "HOURS"
    - name: MICROSECONDS
      value: "MICROSECONDS"
    - name: MILISECONDS
      value: "MILISECONDS"
    - name: MINUTES
      value: "MINUTES"
    - name: NANOSECONDS
      value: "NANOSECONDS"
    - name: SECONDS
      value: "SECONDS"
    type: radio
    defaultValue: HOURS
    optional: false
    sensitive: false
    allowMultiple: false
    dependsOnKey: captureUsageMetrics
    dependsOnValue: true
